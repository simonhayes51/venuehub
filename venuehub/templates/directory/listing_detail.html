{% extends "base.html" %}
{% block title %}{{ item.title }} - VenueHub{% endblock %}
{% block content %}
<nav aria-label="breadcrumb" class="mb-2">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'directory:listings' %}">Listings</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{ item.title }}</li>
  </ol>
</nav>

<div class="d-flex justify-content-between align-items-start">
  <h2 class="mb-2">{{ item.title }} {% if item.is_featured %}<span class="badge bg-warning text-dark">Featured</span>{% endif %}</h2>
  {% if item.edit_code %}<a class="btn btn-outline-secondary btn-sm" href="{% url 'directory:edit_listing' item.pk %}?code={{ item.edit_code }}">Manage</a>{% endif %}
</div>
<p class="text-muted">{{ item.get_category_display }} · {{ item.location }}</p>

{% if item.photo %}<img src="{{ item.photo.url }}" class="img-fluid rounded mb-3" alt="{{ item.title }}">{% endif %}

{% if item.images.all %}
<h5>Gallery</h5>
<div class="row row-cols-2 row-cols-md-3 g-3 mb-3">
  {% for g in item.images.all %}
  <div class="col">
    <div class="card h-100"><img src="{{ g.image.url }}" class="card-img-top" alt="{{ g.caption|default:'Image' }}"></div>
  </div>
  {% endfor %}
</div>
{% endif %}

<p>{{ item.description|linebreaks }}</p>
{% if item.website %}<p><a href="{{ item.website }}" target="_blank" rel="noopener">Website</a></p>{% endif %}

<hr>
<h5>Contact this host</h5>
<form method="post">{% csrf_token %}
  <input type="hidden" name="form_type" value="contact">
  {{ form.as_p }}
  {% if RECAPTCHA_SITE_KEY %}<div class="g-recaptcha mb-2" data-sitekey="{{ RECAPTCHA_SITE_KEY }}"></div>{% endif %}
  <button class="btn btn-primary">Send enquiry</button>
</form>

<hr class="my-4">
<h5>Reviews</h5>
{% if reviews %}
  {% for r in reviews %}
    <div class="border rounded p-2 mb-2">
      <strong>{{ r.rating }}★</strong> — <span class="text-muted">{{ r.venue_name|default:"Verified venue" }}</span><br>
      <div>{{ r.comment|linebreaks }}</div>
      <small class="text-muted">{{ r.created_at|date:"j M Y" }}</small>
    </div>
  {% endfor %}
  {% if avg_rating %}<p class="mt-2"><strong>Average rating:</strong> {{ avg_rating|floatformat:1 }}★</p>{% endif %}
{% else %}
  <p class="text-muted">No reviews yet.</p>
{% endif %}

<div class="mt-3">
  <h6>Leave a review</h6>
  <form method="post" action="{% url 'directory:submit_review' item.pk %}">{% csrf_token %}
    {{ review_form.as_p }}
    {% if RECAPTCHA_SITE_KEY %}<div class="g-recaptcha" data-sitekey="{{ RECAPTCHA_SITE_KEY }}"></div>{% endif %}
    <button class="btn btn-outline-secondary btn-sm" type="submit">Submit review</button>
  </form>
  <small class="text-muted d-block mt-1">Reviews are moderated before publishing.</small>
</div>
{% endblock %}
